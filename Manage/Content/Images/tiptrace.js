function SortByName(n,t){return n.Name<t.Name?-1:n.Name>t.Name?1:0}function IsValidEmail(n){return/^([_a-zA-Z0-9-]+)(\.[_a-zA-Z0-9-]+)*@([a-zA-Z0-9-]+\.)+([a-zA-Z]{2,3})$/.test(n)}function getAttr(n,t){var i=n.getAttribute&&n.getAttribute(t)||null;return i||(i=n.attributes[t]),i}var stripAccents=function(){for(var t="àáâãäçèéêëìíîïñòóôõöùúûüýÿÀÁÂÃÄÇÈÉÊËÌÍÎÏÑÒÓÔÕÖÙÚÛÜÝ",r=new RegExp("["+t+"]","g"),i={},u=function(n){return i[n]||n},n=0;n<t.length;n++)i[t[n]]="aaaaaceeeeiiiinooooouuuuyyAAAAACEEEEIIIINOOOOOUUUUY"[n];return function(n){return n.replace(r,u)}}(),lib={};lib.cookie={setCookie:function(n,t,i){var r=new Date;r.setDate(r.getDate()+i);document.cookie=n+"="+escape(t)+";path=/"+(i==null?"":";expires="+r.toUTCString())},getCookie:function(n){for(var r,u,i=document.cookie.split(";"),t=0;t<i.length;t++)if(r=i[t].substr(0,i[t].indexOf("=")),u=i[t].substr(i[t].indexOf("=")+1),r=r.replace(/^\s+|\s+$/g,""),r==n)return unescape(u);return!1},deleteCookie:function(n){document.cookie=n.replace(/^\s+|\s+$/g,"")+"=;expires=Thu, 01-Jan-1970 00:00:01 GMT"}};$.fn.isOnScreen=function(){var i=$(window),t={top:i.scrollTop(),left:i.scrollLeft()},n;return t.right=t.left+i.width(),t.bottom=t.top+i.height(),n=this.offset(),n.right=n.left+this.outerWidth(),n.bottom=n.top+this.outerHeight(),!(t.right<n.left||t.left>n.right||t.bottom<n.top||t.top>n.bottom)};var LanguageLookup=function(){var n=[],t="en";return n["en.tipvia"]="Tip via",n["en.or"]="or",n["en.loading"]="Loading...",n["en.logout"]="(Log out)",n["nl.tipvia"]="Tip via",n["nl.or"]="of",n["nl.loading"]="Laden...",n["nl.logout"]="(Uitloggen)",{get:function(i){return n[t+"."+i]||"##Translation needed##"},setLanguage:function(n){switch(n){case"nl":t=n;break;default:t="en"}},getLanguage:function(){return t}}}(),TipTraceWidget=function(){function r(){$("#HeaderContainer h2").html(n.value);$.getJSON("/url/?cid="+i.Hash+"&url="+n.value+"&rnd="+Math.random()).success(function(t){n.data=t;n.Loaded=!0;$("#HeaderContainer h1").html(n.data.Title?n.data.Title:"(no title)");$("#HeaderContainer h2").html(n.data.Value)}).fail(function(){$("#HeaderContainer h2,#HeaderContainer h2").html("Error loading link");n.data.Value=n.value})}function u(t){$("#Message").val()==""?TipTraceWidget.DisplayMessage("Please provide a personal message","Info"):(TipTraceWidget.DisplayLoader(),$("#UrlJson").val(JSON.stringify(n.data)),$("#TargetsJson").val(JSON.stringify(User.GetSelectedContacts())),$("#ClientHash").val(i.Hash),$("#ManualName").val(User.SessionInfo().EmailSourceName),$("#ManualEmail").val(User.SessionInfo().EmailSourceEmail),$.ajax({type:t.attr("method"),url:t.attr("action"),data:t.serialize(),success:function(n){TipTraceWidget.ShowShareResult(n);TipTraceWidget.HideLoader()}}))}function f(n){var t=$("#FeedbackEmail").val();IsValidEmail(t)?(TipTraceWidget.DisplayLoader(),$.ajax({type:n.attr("method"),url:n.attr("action"),data:n.serialize(),success:function(){TipTraceWidget.ShowFeedbackMessage();TipTraceWidget.HideLoader()}})):TipTraceWidget.DisplayMessage("Please provide a correct email address","Info")}function e(){User.AddEmailManual()}function o(){$(".ConnectNetwork").on("click",function(){TipTraceWidget.ConnectToNetwork($(this).attr("data-network"),$(this))});$("#ContactContainer .Contacts").on("scroll",function(){clearTimeout(ScrollPoller);ScrollPoller=setTimeout(function(){User.ShowContactImage()},150)});$("#SearchBox").on("keyup",function(){clearTimeout(SearchPoller);SearchPoller=setTimeout(function(){User.FilterContacts(!1)},150)});$("#SearchBox").on("click",function(){$(this).val()!=""&&User.FilterContacts(!1)});$("#ShareForm").on("submit",function(n){n.preventDefault();u($(this))});$("#FeedbackForm").on("submit",function(n){n.preventDefault();f($(this))});$("#AddEmailForm").on("submit",function(n){n.preventDefault();e($(this))});$("#Message").val(t.DefaultTipMessage);$("#AddEmailFormContainer .CloseButton").on("click",function(){TipTraceWidget.HideAddEmailForm()});$(".ResetShare").on("click",function(){User.ResetShare()});$(".Logout").on("click",function(){return User.Logout(),!1})}var n={},i={},t={};return n.value="",n.Loaded=!1,n.data=null,i.Hash=null,t.WithEmailReward=!1,t.WithEmailUpdate=!1,t.DefaultTipMessage="",{initialize:function(u,f,e){t.WithEmailReward=e.WithEmailReward||!1;t.WithEmailUpdate=e.WithEmailUpdate||!1;t.DefaultTipMessage=e.DefaultTipMessage||"";i.Hash=f||null;TipTraceWidget.InitText();TipTraceWidget.InitPlaceholder();o();n.value=u;r();User.Login(null)},InitText:function(){var n=(navigator.userLanguage||window.navigator.language).slice(0,2).toLowerCase();LanguageLookup.setLanguage(n);$("#HeaderContainer .TipVia").html(LanguageLookup.get("tipvia"));$("#HeaderContainer .Or").html(LanguageLookup.get("or"));$("#HeaderContainer h1, #HeaderContainer h2").html(LanguageLookup.get("loading"));$("#HeaderContainer .Or").html(LanguageLookup.get("or"));$("#HeaderContainer .Logout").html(LanguageLookup.get("logout"))},DisplayLoader:function(){$("#LoadingContainer").show()},HideLoader:function(){$("#LoadingContainer").hide()},HideMessage:function(){$("#FeedbackMessage").hide(200)},DisplayMessage:function(n){$("#FeedbackMessage").hide();$("#FeedbackMessage").html(n);$("#FeedbackMessage").show(200);clearInterval(MessageTimer);MessageTimer=setTimeout(function(){TipTraceWidget.HideMessage()},2e3)},UpdateStatus:function(n){$("#Container").removeClass("NotLoggedOn");$("#Container").removeClass("LoggedOn");$("#Container").removeClass("ContactSelected");$("#Container").removeClass("ShareFinished");$("#Container").addClass(n)},DisplayAddEmailForm:function(){$("#AddEmailTargetName").val("");$("#AddEmailTargetEmail").val("");User.SessionInfo().EmailSourceEmail!=null?$("#AddEmailSourceEmail").hide():$("#AddEmailSourceEmail").val("");User.SessionInfo().EmailSourceName!=null?$("#AddEmailSourceName").hide():$("#AddEmailSourceName").val("");$("#AddEmailFormContainer").show();$("#AddEmailSourceName").focus()},HideAddEmailForm:function(){$("#AddEmailFormContainer").hide()},ShowFeedbackMessage:function(){$("#FeedBackSuccesMessage").show();$("#FeedbackForm").hide()},InitFeedbackForm:function(){$("#FeedBackSuccesMessage").hide();$("#FeedbackForm").show();$("#FeedbackForm input:checkbox").removeAttr("checked");t.WithEmailReward||t.WithEmailUpdate||$("#FeedbackForm").hide();t.WithEmailReward?$("#FeedbackListItemReward").show():$("#FeedbackListItemReward").hide();t.WithEmailUpdate?$("#FeedbackListItemUpdate").show():$("#FeedbackListItemUpdate").hide()},ShowShareResult:function(n){n.ShareSessionId&&$("#FeedbackShareSessionId").val(n.ShareSessionId);TipTraceWidget.InitFeedbackForm();$("#Message").val("");$("#SearchBox").val("");User.FilterContacts(!1);User.DeselectAllContacts();TipTraceWidget.UpdateStatus("ShareFinished")},InitPlaceholder:function(){$("[placeholder]").focus(function(){var n=$(this);n.val()==n.attr("placeholder")&&(n.val(""),n.removeClass("placeholder"))}).blur(function(){var n=$(this);(n.val()==""||n.val()==n.attr("placeholder"))&&(n.addClass("placeholder"),n.val(n.attr("placeholder")))}).blur();$("[placeholder]").parents("form").submit(function(){$(this).find("[placeholder]").each(function(){var n=$(this);n.val()==n.attr("placeholder")&&n.val("")})})},ConnectToNetwork:function(n,t){if(t=$(t),n=="email")TipTraceWidget.DisplayAddEmailForm();else if(User.NetworkIsConnected(n)&&!t.hasClass("error"))t.hasClass("selected")?t.removeClass("selected"):t.addClass("selected"),User.FilterContacts(!1);else{var i="/"+n;window.open(i,"ConnectNetwork","width=600,height=400,toolbars=0,menubar=0,location=0,scrollbars=1,resizable=1,status=0");clearInterval(NetworkPoller);NetworkPoller=setInterval(function(){User.pollForNetworkCookie(n)},1e3)}}}}(),User=function(){function u(){$("#SelectedContactList").html("");TipTraceWidget.UpdateStatus("LoggedOn");var n=0;$.each(r,function(t,i){if(i.Selected){TipTraceWidget.UpdateStatus("ContactSelected");var r=$(i.Container.clone());r.show();$("#SelectedContactList").append(r);r.click(function(){i.Selected=!i.Selected;i.Selected?$(i.Container).addClass("Selected"):$(i.Container).removeClass("Selected");u()});n++}});User.UpdateSelectedContactCounter(n)}var n={},t={},r;return n.IsloggedOn=!1,n.Name=null,n.Hash=null,t.NetworksLoaded=!1,t.EmailLoaded=!1,t.EmailSourceName=null,t.EmailSourceEmail=null,r=[],{Info:function(){return n},SessionInfo:function(){return t},DeselectAllContacts:function(){$.each(r,function(n,t){t.Selected=!1;$(t.Container).removeClass("Selected")});u()},AddEmailManual:function(){var n={},i=$("#AddEmailTargetName").val(),f=$("#AddEmailTargetEmail").val(),e=t.EmailSourceName?t.EmailSourceName:$("#AddEmailSourceName").val(),o=t.EmailSourceEmail?t.EmailSourceEmail:$("#AddEmailSourceEmail").val();n.Network="Email";n.SourceType=6;n.Name=i;n.Identifier=f;$("#Network_email").addClass("selected").addClass("connected");t.EmailLoaded=!0;User.AddContact(n,!0);r.push(n);t.EmailSourceName=e;t.EmailSourceEmail=o;User.SortContacts();u();TipTraceWidget.HideAddEmailForm()},NetworkIsConnected:function(t){if(n.IsloggedOn)for(i=0;i<n.ConnectedNetworks.length;i++)if(n.ConnectedNetworks[i].Id==t)return!0;return!1},ResetShare:function(){$("#SearchBox").val("");User.DeselectAllContacts();User.Display()},GetContacts:function(i){var u=0;n.IsloggedOn&&(t.NetworksLoaded||TipTraceWidget.DisplayLoader(),$.each(n.ConnectedNetworks,function(f,e){if(!t.NetworksLoaded||e.Id==i){var o=$("#Network_"+e.Id);o.removeClass("error");o.addClass("loading");User.RemoveContacts(e.Id);e.Id=="email"&&(t.EmailLoaded=!0,t.EmailSourceName=e.Name,t.EmailSourceEmail=e.Identifier,$("#AddEmailSourceName").val(t.EmailSourceName),$("#AddEmailSourceEmail").val(t.EmailSourceEmail));$.getJSON("/"+e.Id+"/FriendList/"+n.Hash).success(function(n){for(var t,u=0;u<n.length;u++)t=n[u],t.Selected=!1,delete t.ShareStatus,User.AddContact(t,!1),r.push(t);clearTimeout(ProcessTimer);ProcessTimer=setTimeout(function(){f>1&&e.Id!=i&&User.SortContacts();User.ShowContactImage()},400);o.removeClass("loading");TipTraceWidget.HideLoader()}).complete(function(){u++;(u>=n.ConnectedNetworks.length||e.Id==i)&&(clearTimeout(ProcessTimer),ProcessTimer=setTimeout(function(){User.SortContacts();User.ShowContactImage()},0),User.FilterContacts(!0));o.removeClass("loading");TipTraceWidget.HideLoader()}).error(function(){o.addClass("error")})}}),t.NetworksLoaded=!0)},UpdateSelectedContactCounter:function(n){var t=10,i=t-n,r=$("#ContactContainer .SelectedContacts h2 span.Counter");r.html(i>=6?"":n+"/"+t)},AddContact:function(n,t){var f,i=[],r;i.push("<a href='javascript:void(0);' class='ClearFix'>");i.push("<img class='Icon ");i.push(n.Network);i.push("' src='/content/images/icons/");i.push(n.Network.toLowerCase());i.push(".png' data-pic='");i.push(n.ProfilePicure);i.push("'/>");i.push("<span class='Name'>");i.push(n.Name);i.push("<\/span>");i.push("<span class='Network'>");n.SourceType==3||n.SourceType==4||n.SourceType==6?i.push(n.Identifier):i.push(n.Network.toLowerCase());i.push("<\/span>");i.push("<span class='Button'><\/span><\/a>");f=i.join("");r=document.createElement("li");r.setAttribute("data-name",n.Name.toUpperCase());r.innerHTML=f;r=$(r);n.Container=r;$("#ContactList").append(r);n.Selected=t;n.Selected&&r.addClass("Selected");r.on("click",function(){if(User.GetSelectedContacts().length<10||n.Selected){var t=$(this);n.Selected=!n.Selected;n.Selected?t.addClass("Selected"):t.removeClass("Selected");u()}})},GetSelectedContacts:function(){var n=[];return $.each(r,function(t,i){if(i.Selected){var r=jQuery.extend({},i);delete r.Container;delete r.ProfilePicure;n.push(r)}}),n},FilterContacts:function(n){var e=$("#SearchBox"),f=e.val(),s=f!=""&&f!=e.attr("placeholder"),u,t,i,o;if(r.length>0&&!n){for(u=0;u<r.length;u++)t=r[u],i=$("#Network_"+t.Network.toLowerCase()).hasClass("selected"),i&&s&&(o=new RegExp(f,"gi"),i=o.test(stripAccents(t.Name))),i?t.Container.removeClass("hideContact"):t.Container.addClass("hideContact"),i?t.Container.addClass("showContact"):t.Container.removeClass("showContact");$("#ContactList li.hideContact").hide();$("#ContactList li.showContact").show();User.ShowContactImage()}},SortContacts:function(){var n=$("#ContactList");$(n).children("li").sort(function(n,t){var i=getAttr(n,"data-name"),r=getAttr(t,"data-name");return i==r?0:i>r?1:-1}).appendTo(n)},ShowContactImage:function(){var n=0;$.each($("#ContactList img.Icon"),function(t,i){if(n<=40){var r=$(i);r.is(":visible")&&r.attr("src")!=r.data("pic")&&r.data("pic")!=""&&r.isOnScreen()&&(r.attr("src",r.data("pic")),n++)}})},RemoveContacts:function(n){$.each(r,function(t,i){i.Network==n&&(i.Container.remove(),r.splice(t,1))})},Display:function(r){if(n.IsloggedOn&&TipTraceWidget.UpdateStatus("LoggedOn"),t.NetworksLoaded||$("#Networks .ConnectNetwork").removeClass("selected"),t.EmailLoaded&&$("#Network_email").addClass("selected").addClass("connected"),n&&n.ConnectedNetworks)for(i=0;i<n.ConnectedNetworks.length;i++)if(!t.NetworksLoaded||n.ConnectedNetworks[i].Id==r){var u=$("#Network_"+n.ConnectedNetworks[i].Id);u.addClass("selected").addClass("connected")}},Login:function(t){var i=lib.cookie.getCookie("TipTraceHash"),r;delete n.ConnectedNetworks;i&&(r="/user/get/"+i,$.getJSON(r).success(function(r){r&&(n=r,n.IsloggedOn=!0,n.Hash=i,n.Name=n.ConnectedNetworks.length>0?n.ConnectedNetworks[0].Name:"",User.Display(t),$("#FeedbackEmail").val(User.Email),User.GetContacts(t))}).error(function(){}))},Logout:function(){TipTraceWidget.HideMessage();lib.cookie.deleteCookie("NetworkConnected");lib.cookie.deleteCookie("TipTraceHash");$("#FeedbackEmail").val("");$("#Networks .connected").removeClass("connected selected error");n.IsloggedOn=!1;delete n.ConnectedNetworks;n.Name=null;r.length=0;$("#ContactList").html("");t.NetworksLoaded=!1;TipTraceWidget.UpdateStatus("NotLoggedOn");TipTraceWidget.DisplayMessage("You are now logged off","Info")},pollForNetworkCookie:function(n){var t=lib.cookie.getCookie("NetworkConnected");t&&t==n&&(lib.cookie.deleteCookie("NetworkConnected"),clearInterval(NetworkPoller),User.Login(t))}}}(),NetworkPoller=null,SearchPoller=null,ScrollPoller=null,ProcessTimer=null,MessageTimer=null